<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>製作 CV - Easy Job</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    .step{display:none}.step.active{display:block}
    .tag{background:#e5e7eb;padding:4px 12px;border-radius:999px;margin:4px;display:inline-block;font-size:14px}
    .remove{color:#ef4444;cursor:pointer;margin-left:8px}
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

<!-- 导航栏 -->
<nav class="bg-cyan-500 text-white py-4 shadow-lg">
  <div class="container mx-auto px-4 flex items-center justify-between">
    <a href="index.html" class="text-3xl font-bold">EASY<span class="text-2xl"> Easy Job</span></a>
    <div class="hidden md:flex space-x-8">
      <a href="cv-template.html" class="underline font-bold">CV Template</a>
      <a href="login.html" class="bg-black px-6 py-2 rounded-full">Login</a>
    </div>
  </div>
</nav>

<div class="flex-1 container mx-auto max-w-5xl px-4 py-8">
  <div class="text-center mb-8">
    <span class="text-3xl font-bold text-cyan-600">Step <span id="cur">1</span>/6</span>
  </div>

  <form id="form">
    <!-- Step 1：基本信息 + 头像 -->
    <div class="step active bg-white rounded-2xl shadow-lg p-8" id="step1">
      <h2 class="text-3xl font-bold mb-8">Basic Information</h2>
      <div class="grid md:grid-cols-3 gap-6">
        <input type="text" data-key="firstName" placeholder="First Name *" required class="border rounded-lg px-4 py-3">
        <input type="text" data-key="lastName" placeholder="Last Name *" required class="border rounded-lg px-4 py-3">
        <input type="text" data-key="jobTitle" placeholder="Job Title *" required class="border rounded-lg px-4 py-3">
        <input type="tel" data-key="phone" placeholder="Phone" class="border rounded-lg px-4 py-3">
        <input type="email" data-key="email" placeholder="Email *" required class="border rounded-lg px-4 py-3 md:col-span-2">
        <input type="text" data-key="address" placeholder="Address" class="border rounded-lg px-4 py-3 md:col-span-3">
        <div class="md:col-span-3">
          <label class="block font-medium mb-2">頭像（圓形）</label>
          <input type="file" id="photoInput" accept="image/*" class="border rounded-lg p-3 w-full">
        </div>
      </div>
    </div>

    <!-- Step 2：Skills & Language -->
    <div class="step bg-white rounded-2xl shadow-lg p-8" id="step2">
      <h2 class="text-3xl font-bold mb-8">Skills & Language</h2>
      <div class="grid md:grid-cols-2 gap-10">
        <div>
          <h3 class="text-xl font-bold mb-4">Professional Skills</h3>
          <input type="text" id="skillIn" placeholder="輸入技能後按 Enter" class="border rounded-lg px-4 py-3 w-full mb-3">
          <div id="skillsBox" class="flex flex-wrap"></div>
        </div>
        <div>
          <h3 class="text-xl font-bold mb-4">Languages</h3>
          <div id="langBox"></div>
          <button type="button" onclick="addLang()" class="text-cyan-600 mt-3">+ Add Language</button>
        </div>
      </div>
    </div>

    <!-- Step 3：Education -->
    <div class="step bg-white rounded-2xl shadow-lg p-8" id="step3">
      <h2 class="text-3xl font-bold mb-8">Education</h2>
      <div id="eduBox"></div>
      <button type="button" onclick="addEdu()" class="text-cyan-600">+ Add Education</button>
    </div>

    <!-- Step 4：Work Experience -->
    <div class="step bg-white rounded-2xl shadow-lg p-8" id="step4">
      <h2 class="text-3xl font-bold mb-8">Work Experience</h2>
      <div id="expBox"></div>
      <button type="button" onclick="addExp()" class="text-cyan-600">+ Add Experience</button>
    </div>

    <!-- Step 5：About Me -->
    <div class="step bg-white rounded-2xl shadow-lg p-8" id="step5">
      <h2 class="text-3xl font-bold mb-8">About Me</h2>
      <textarea data-key="about" placeholder="寫一點關於自己的介紹..." class="border rounded-lg w-full h-64 p-4"></textarea>
    </div>

    <!-- Step 6：真實預覽 + 下載 -->
    <div class="step bg-white rounded-2xl shadow-lg p-10" id="step6">
      <h2 class="text-3xl font-bold text-center mb-10">Your CV（所見即所得）</h2>
      <div class="bg-gray-100 rounded-xl p-8 overflow-x-auto">
        <div id="preview" class="mx-auto"></div>
      </div>
      <div class="text-center mt-10">
        <button type="button" onclick="download()" class="bg-black text-white px-16 py-5 rounded-full text-xl font-bold hover:bg-gray-800">
          Download PDF
        </button>
      </div>
    </div>

    <div class="flex justify-between mt-12">
      <button type="button" onclick="prev()" class="border px-10 py-3 rounded-full">Back</button>
      <button type="button" onclick="next()" class="bg-black text-white px-10 py-3 rounded-full">Continue</button>
    </div>
  </form>
</div>

<script>
// 读取模板
const url = new URLSearchParams(location.search);
const tmpl = url.get('template') || 'black-white';
let photo = 'user.jpg';
document.getElementById('photoInput').onchange = e => {
  if(e.target.files[0]) photo = URL.createObjectURL(e.target.files[0]);
};

// 三套真实模板（像素级还原你三张图）
const templates = {
  'black-white': `<div style="width:210mm;min-height:297mm;background:#fff;padding:20mm;font-family:Arial,sans-serif;color:#000;">
    <div style="display:flex;gap:20mm;">
      <img src="${photo}" style="width:110px;height:110px;border-radius:50%;object-fit:cover;">
      <div>
        <h1 style="font-size:38px;margin:0;font-weight:900;">{fullName}</h1>
        <p style="font-size:20px;color:#06b6d4;margin:5px 0;">{jobTitle}</p>
        <p style="font-size:14px;color:#555;">{phone} • {email} • {address}</p>
      </div>
    </div>
    <h2 style="font-size:22px;margin:40px 0 10px;border-bottom:3px solid #06b6d4;padding-bottom:8px;">ABOUT ME</h2>
    <p style="line-height:1.8;">{about}</p>
    <h2 style="font-size:22px;margin-top:30px;border-bottom:3px solid #06b6d4;padding-bottom:8px;">EDUCATION</h2>
    <div id="eduHere"></div>
    <h2 style="font-size:22px;margin-top:30px;border-bottom:3px solid #06b6d4;padding-bottom:8px;">EXPERIENCE</h2>
    <div id="expHere"></div>
    <h2 style="font-size:22px;margin-top:30px;border-bottom:3px solid #06b6d4;padding-bottom:8px;">SKILLS & LANGUAGES</h2>
    <p>{skills}</p>
  </div>`,

  'grey-modern': `<div style="width:210mm;min-height:297mm;background:#f9fafb;padding:15mm;font-family:Arial,sans-serif;">
    <div style="background:#1f2937;color:#fff;padding:40px;text-align:center;border-radius:16px 16px 0 0;">
      <img src="${photo}" style="width:140px;height:140px;border-radius:50%;border:6px solid #fff;margin-bottom:20px;">
      <h1 style="font-size:48px;font-weight:900;margin:0;">{fullName}</h1>
      <p style="font-size:22px;margin:10px 0 0;">{jobTitle}</p>
    </div>
    <div style="background:#fff;padding:40px;display:grid;grid-template-columns:1fr 1fr;gap:40px;">
      <div>
        <h2 style="font-size:22px;color:#1f2937;border-left:5px solid #06b6d4;padding-left:12px;">Experience</h2>
        <div id="expHere" style="margin-top:20px;"></div>
      </div>
      <div>
        <h2 style="font-size:22px;color:#1f2937;border-left:5px solid #06b6d4;padding-left:12px;">Education</h2>
        <div id="eduHere" style="margin-top:20px;"></div>
        <h2 style="font-size:22px;color:#1f2937;border-left:5px solid #06b6d4;padding-left:12px;margin-top:30px;">Skills & Languages</h2>
        <p style="margin-top:15px;">{skills}</p>
      </div>
    </div>
  </div>`,

  'beige-brown': `<div style="width:210mm;min-height:297mm;background:#faf6f1;padding:0;font-family:Arial,sans-serif;">
    <div style="background:#8b6f47;color:#fff;padding:60px 40px;border-radius:0 0 50px 50px;position:relative;">
      <h1 style="font-size:58px;font-weight:900;margin:0;">{fullName}</h1>
      <p style="font-size:26px;margin:10px 0;">{jobTitle}</p>
      <img src="${photo}" style="width:220px;height:220px;object-fit:cover;border-radius:50%;border:12px solid #fff;position:absolute;top:50%;right:40px;transform:translateY(-50%);">
    </div>
    <div style="padding:50px 40px;display:grid;grid-template-columns:1fr 1fr 1fr;gap:40px;color:#444;">
      <div><h2 style="font-size:26px;color:#8b6f47;font-weight:700;margin-bottom:20px;">EXPERIENCE</h2><div id="expHere"></div></div>
      <div><h2 style="font-size:26px;color:#8b6f47;font-weight:700;margin-bottom:20px;">EDUCATION</h2><div id="eduHere"></div></div>
      <div><h2 style="font-size:26px;color:#8b6f47;font-weight:700;margin-bottom:20px;">SKILLS & ABOUT</h2>
        <p style="line-height:1.8;">{skills}</p>
        <p style="margin-top:20px;">{about}</p>
      </div>
    </div>
  </div>`
};

let step = 1;
function updateStep(){document.getElementById('cur').textContent=step;}
function next(){
  if(step===5) generate();
  if(step<6){document.getElementById('step'+step).classList.remove('active');step++;document.getElementById('step'+step).classList.add('active');updateStep();}
  if(step===6) document.querySelector('[onclick="next()"]').textContent='Download PDF';
}
function prev(){if(step>1){document.getElementById('step'+step).classList.remove('active');step--;document.getElementById('step'+step).classList.add('active');updateStep();}}

// 技能
document.getElementById('skillIn').addEventListener('keydown',e=>{if(e.key==='Enter'&&e.target.value.trim()){
  const s=document.createElement('span');s.className='tag';
  s.innerHTML=e.target.value.trim()+' <span class="remove" onclick="this.parentElement.remove()">×</span>';
  document.getElementById('skillsBox').appendChild(s);e.target.value='';
}});

// 语言
function addLang(){
  const d=document.createElement('div');d.className='flex gap-3 mb-3';
  d.innerHTML=`<input type="text" placeholder="Language" class="border rounded px-3 py-2 flex-1">
               <select class="border rounded px-3 py-2"><option>Beginner</option><option>Intermediate</option><option>Advanced</option><option>Fluent</option><option>Native</option></select>
               <span class="remove" onclick="this.parentElement.remove()">×</span>`;
  document.getElementById('langBox').appendChild(d);
}

// 教育、工作经验动态添加
function addEdu(){addBlock('eduBox','Degree','University','Start','End','Description');}
function addExp(){addBlock('expBox','Job Title','Company','Start','End','Responsibilities');}
function addBlock(box,title1,title2,start,end,desc){
  const div=document.createElement('div');div.className='border rounded-lg p-5 mb-5 relative';
  div.innerHTML=`<span class="remove absolute top-2 right-2" onclick="this.parentElement.remove()">×</span>
    <input placeholder="${title1}" class="border rounded w-full mb-3 px-3 py-2">
    <input placeholder="${title2}" class="border rounded w-full mb-3 px-3 py-2">
    <div class="grid grid-cols-2 gap-4 mb-3">
      <input placeholder="${start} (e.g. 2020)" class="border rounded px-3 py-2">
      <input placeholder="${end} (e.g. 2024 or Present)" class="border rounded px-3 py-2">
    </div>
    <textarea placeholder="${desc}" class="border rounded w-full h-28 px-3 py-2"></textarea>`;
  document.getElementById(box).appendChild(div);
}

// 生成预览
function generate(){
  const data={};
  document.querySelectorAll('[data-key]').forEach(i=>data[i.dataset.key]=i.value||'');
  data.fullName=(data.firstName||'')+' '+(data.lastName||'').trim()|| 'YOUR NAME';
  
  // 技能
  data.skills=Array.from(document.querySelectorAll('#skillsBox .tag')).map(t=>t.firstChild.textContent||t.textContent).join(' • ') || '—';
  
  let html = templates[tmpl];
  for(let k in data) html=html.replace(new RegExp('{'+k+'}','g'),data[k]);
  
  // 教育 & 经验
  let edu='',exp='';
  document.querySelectorAll('#eduBox > div').forEach(b=>{
    const v=b.querySelectorAll('input,textarea');
    edu+=`<p><strong>${v[1].value||'University'}</strong> — ${v[0].value||'Degree'}<br>${v[2].value||''} - ${v[3].value||'Present'}<br>${v[4].value||''}</p>`;
  });
  document.querySelectorAll('#expBox > div').forEach(b=>{
    const v=b.querySelectorAll('input,textarea');
    exp+=`<p><strong>${v[0].value||'Job Title'}</strong> at ${v[1].value||'Company'}<br>${v[2].value||''} - ${v[3].value||'Present'}<br>${v[4].value||''}</p>`;
  });
  
  document.getElementById('preview').innerHTML=html;
  document.getElementById('eduHere').innerHTML=edu||'<p>No education added</p>';
  document.getElementById('expHere').innerHTML=exp||'<p>No experience added</p>';
}

// 下载PDF
function download(){
  const opt={
    margin:0,
    filename:(document.querySelector('[data-key="firstName"]').value||'My')+'_CV.pdf',
    image:{type:'jpeg',quality:0.98},
    html2canvas:{scale:2.5},
    jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}
  };
  html2pdf().set(opt).from(document.getElementById('preview')).save();
}

// 初始化
addLang();addEdu();addExp();
</script>
</body>
</html>